<!DOCTYPE HTML>
<html>
  <head>
    <title>Pawthways — Watch & Help</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript>
      <link rel="stylesheet" href="assets/css/noscript.css" />
    </noscript>
  </head>
  <body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper" class="divided">

      <!-- HERO -->
      <section
        class="banner style1 orient-left content-align-left image-position-right onload-image-fade-in onload-content-fade-right"
      >
        <div class="content">
          <h1>Watch & Help</h1>
          <p class="major">
            Real cases. Real animals. Transparent goals.
            Every card below is powered directly from our rescue database —
            no fake stories, no invisible money.
          </p>
          <ul class="actions stacked">
            <li>
              <a href="/index.html" class="button smooth-scroll-middle">
                Read the origin story
              </a>
            </li>
          </ul>
        </div>
        <div class="image">
          <img
            src="images/paw-hero.jpg"
            alt="Pawthways rescue"
          />
        </div>
      </section>

      <!-- WATCH THE STORY & HELP -->
      <section class="wrapper style1 align-center">
        <div class="inner">
          <h2>Watch the Story & Help</h2>
          <p>
            Watching and sharing this story amplifies our reach and supports
            our pledge to fund real rescues featured on Pawthways.
          </p>
          <div
            style="
              position:relative;
              padding-bottom:56.25%;
              height:0;
              overflow:hidden;
              border-radius:16px;
              max-width:960px;
              margin:0 auto;
            "
          >
            <iframe
              src="https://www.youtube.com/embed/sRBxWGkS_bg?rel=0&modestbranding=1"
              title="The Bottle That Carried Us — Pawthways"
              frameborder="0"
              allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              style="
                position:absolute;
                top:0;
                left:0;
                width:100%;
                height:100%;
                border:0;
              "
            ></iframe>
          </div>
        </div>
      </section>

      <!-- ACTIVE RESCUES LIST (Supabase-powered) -->
      <section id="active-rescues" class="wrapper style1 align-center">
        <div class="inner">
          <h2>Active Rescues You Can Help Now</h2>
          <p id="rescues-status">
            Loading verified cases...
          </p>

          <div id="rescues-list" class="items style1 medium">
            <!-- Cards will be injected here by JS -->
          </div>
        </div>
      </section>

      <!-- WHY THIS MATTERS / CTA -->
      <section class="wrapper style3 align-center">
        <div class="inner">
          <h2>Why this matters</h2>
          <p>
            Pawthways connects emotional stories with verifiable impact.
            When a rescue is funded or completed, you’ll see it reflected here
            and in our Transparency page.
          </p>
          <ul class="actions stacked">
            <li>
              <a href="#active-rescues" class="button primary">
                Support the next rescue
              </a>
            </li>
            <li>
              <a href="/index.html" class="button">
                Relive the Pawthways story
              </a>
            </li>
            <li>
              <a href="/transparency.html" class="button">
                See Transparency
              </a>
            </li>
          </ul>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="wrapper style1 align-center">
        <div class="inner">
          <p>Pawthways — Turning one leap into thousands of second chances.</p>
        </div>
      </footer>
    </div>

    <!-- Supabase JS -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.49.1/dist/umd/supabase.min.js"></script>

    <!-- Template JS -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>

    <!-- Pawthways: Load active rescues from Supabase -->
    <script>
      const SUPABASE_URL = 'https://fjlonwabqmbzkprddqsv.supabase.co';
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqbG9ud2FicW1iemtwcmRkcXN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MDY3ODEsImV4cCI6MjA3ODM4Mjc4MX0.jBnyGnIhmAUFGg0RL8sw-5L8tBAgiJM5s-AXuHPtMuU';

      const supabaseClient = supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      async function loadActiveRescues() {
        const statusEl = document.getElementById('rescues-status');
        const listEl = document.getElementById('rescues-list');

        if (!statusEl || !listEl) return;

        statusEl.textContent = 'Loading verified cases...';

        const { data, error } = await supabaseClient
          .from('rescues')
          .select(
            'id, title, animal_name, location, target_amount, currency, status, image_url, story, created_at'
          )
          .eq('status', 'active')
          .order('created_at', { ascending: false });

        if (error) {
          console.error('Error loading rescues:', error);
          statusEl.textContent =
            'We could not load rescues right now. Please try again in a moment.';
          return;
        }

        if (!data || data.length === 0) {
          statusEl.textContent =
            'No active rescues at this moment — check back soon.';
          return;
        }

        statusEl.textContent = '';

        listEl.innerHTML = data
          .map((rescue) => {
            const imgHtml = rescue.image_url
              ? `
              <div class="image">
                <img src="${rescue.image_url}" alt="${rescue.title || 'Rescue case'}" />
              </div>`
              : '';

            const goal = rescue.target_amount
              ? `Goal: ${rescue.target_amount} ${rescue.currency || ''}`
              : '';

            const snippet = rescue.story
              ? rescue.story.length > 220
                ? rescue.story.substring(0, 220) + '…'
                : rescue.story
              : '';

            return `
              <section class="spotlight style1 orient-left content-align-left image-position-center">
                ${imgHtml}
                <div class="content">
                  <h3>${rescue.title || 'Rescue case'}</h3>
                  <p>
                    ${
                      rescue.animal_name
                        ? `<strong>${rescue.animal_name}</strong> · `
                        : ''
                    }
                    ${rescue.location || ''}
                  </p>
                  ${goal ? `<p>${goal}</p>` : ''}
                  ${snippet ? `<p>${snippet}</p>` : ''}
                  <ul class="actions stacked">
                    <li>
                      <a href="/Donate" class="button primary">
                        Help this rescue
                      </a>
                    </li>
                  </ul>
                </div>
              </section>
            `;
          })
          .join('');
      }

      document.addEventListener('DOMContentLoaded', loadActiveRescues);
    </script>
  </body>
</html>
